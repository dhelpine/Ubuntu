#----------------------------------------------#
# SQUID-3.x - Performance Configuration
# Customize by Bags
#----------------------------------------------#
shutdown_lifetime 5 seconds
icp_port 0

#----------------------------------------------#
# ADMINISTRATIVE PARAMETERS
#----------------------------------------------#
cache_effective_user proxy
cache_effective_group proxy
umask 022

pid_filename /var/run/squid.pid

cache_mem 8 MB
digest_generation off

memory_replacement_policy heap GDSF
cache_replacement_policy heap LFUDA

maximum_object_size_in_memory 0 KB
maximum_object_size 1024000 KB
minimum_object_size 0 KB

cache_dir aufs /cache 325500 32 256
request_body_max_size 0 KB

icap_enable on

strip_query_terms off
log_mime_hdrs off
forwarded_for off
via off

#----------------------------------------------#
# ACLs PARAMETERS
#----------------------------------------------#
acl within_timeframe time MTWHFAS 00:00-24:00
acl all src
acl SSL_ports port 443 # https
acl SSL_ports port 563 # snews
acl Safe_ports port 21 # ftp
acl Safe_ports port 70 # gopher
acl Safe_ports port 80 # http
acl Safe_ports port 88 # kerberos
acl Safe_ports port 182 # streaming
acl Safe_ports port 210 # wais
acl Safe_ports port 280 # http-mgmt
acl Safe_ports port 443 # https
acl Safe_ports port 488 # gss-http
acl Safe_ports port 563 # snews
acl Safe_ports port 591 # filemaker
acl Safe_ports port 777 # multiling http
acl Safe_ports port 1025-65535 # unregistered ports
acl Safe_ports port 3128 # Squids port (for icons)
acl CONNECT method CONNECT

access_log stdio:/tmp/access.log !CONNECT
cache_log /tmp/cache.log
cache_store_log none

acl allowrangeurl url_regex -i ^https?\:\/\/garena\.edge\.cdn\.starhub\.com\/.*
acl allowrangeurl url_regex -i ^https?\:\/\/file\.atlantica\.gemscool\.com\/UnitPatch\/NPatch\/.*
acl allowrangeurl url_regex -i ^https?\:\/\/patch\.gemscool\.com\/th\/patch\/.*
acl allowrangeurl url_regex -i ^https?\:\/\/update\.netmarble\.co\.id\/Elsword\/Patch/.*

acl ytHack url_regex -i \/pagead\/js\/lidar\.js
acl ytHack url_regex -i google\.com\/js\/bg\/.*\.js
deny_info http://pastebin.com/raw.php?i=ZKczrn1C ytHack

acl crome url_regex -i ^http:\/\/.*\.pack.google.com\/edgedl\/chrome\/win\/.*
acl crome url_regex -i ^http:\/\/cache.pack.google.com\/edgedl\/.*
acl crome url_regex -i ^http:\/\/www.google.com\/dl\/chrome\/win\/.*

acl patchini url_regex -i ^https?\:\/\/.*\.ini$
acl semuaurl url_regex -i ^https?\:\/\/.*
acl http302 http_status 302
acl mimetext rep_mime_type mime-type ^text$
acl mimehtml rep_mime_type mime-type ^text/html
acl getmethod method GET

#----------------------------------------------#
#Access to squid:
#local machine, no restriction
#----------------------------------------------#
http_access allow         localhost
http_access deny          !Safe_ports
http_access deny  CONNECT !SSL_ports
http_access allow SSL_ports
http_access allow  all
http_reply_access allow all

http_access deny ytHack
http_access deny crome

httpd_suppress_version_string on

#----------------------------------------------#
# TPROXY
# ---------------------------------------------#
http_port 3128
http_port 3129 tproxy
https_port 3127 tproxy ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=40MB cert=/etc/squid/ssl_cert/myCA.pem

cache deny localhost

#----------------------------------------------#
#Strip HTTP Header
#----------------------------------------------#
range_offset_limit none allowrangeurl

request_header_access Range deny !allowrangeurl
request_header_access Accept-Range deny !allowrangeurl
request_header_access Content-Range deny !allowrangeurl
reply_header_access Accept-Range deny !allowrangeurl
reply_header_access Content-Range deny !allowrangeurl
reply_header_access Range deny !allowrangeurl

request_header_access X-Forwarded-For deny all
reply_header_access X-Forwarded-For deny all
request_header_access Via deny all
reply_header_access Via deny all

#----------------------------------------------#
#INCLUDE CONFIGURATION / BYPASS
#----------------------------------------------#
#include /etc/squid/squid.conf.bypass

#nfsw
acl bypass dst 94.236.124.241

#----------------------------------------------#
#SSL CONFIGURATION
#----------------------------------------------#

always_direct allow all
ssl_bump none localhost
ssl_bump none bypass
ssl_bump server-first all
sslproxy_cert_error allow all
sslproxy_flags DONT_VERIFY_PEER
sslcrtd_program /usr/lib/squid/ssl_crtd -s /etc/squid/ssl_db/certs/ -M 4MB
sslcrtd_children 50 startup=50

#----------------------------------------------#
#STORE_ID HELPERS
#----------------------------------------------#
store_id_program /etc/squid/storeid.pl
store_id_children 50 startup=50
store_id_access deny !getmethod
store_id_access allow semuaurl
store_id_access deny all

store_miss deny patchini
send_hit deny patchini
store_miss deny semuaurl http302
send_hit deny semuaurl http302
store_miss deny semuaurl mimetext
send_hit deny semuaurl mimetext
store_miss deny semuaurl mimehtml
send_hit deny semuaurl mimehtml

#--------------------------------------------#
# TUNING
#--------------------------------------------#

cache_swap_high 99
cache_swap_low 98

ipcache_size 2048
ipcache_low 90
ipcache_high 95

qos_flows local-hit=0x30

visible_hostname PROXY.SERVER

#--------------------------------------------#
# DNS PARAMETERS
#--------------------------------------------#
dns_nameservers 208.67.222.222 208.67.220.220

#----------------------------------------------#
# REFRESH PATTERN
#----------------------------------------------#
#refresh_pattern -i (patch|Patch|hackshield). 0 95% 432000 ignore-no-store ignore-private reload-into-ims store-stale
refresh_pattern -i ^https?\:\/\/helpr\/youtube\/.* 432000 100% 432000 override-expire override-lastmod ignore-reload ignore-no-store ignore-private ignore-auth ignore-must-revalidate store-stale
refresh_pattern . 0 95% 432000 override-expire override-lastmod refresh-ims reload-into-ims ignore-no-store ignore-private ignore-auth ignore-must-revalidate

max_filedescriptors 65536
max_stale 1 years

#--------------------------------------------#
# ENDS OF CONFIG
#--------------------------------------------#
